
@{
    ViewData["Title"] = "主页";
    System.Text.StringBuilder sb = new System.Text.StringBuilder();
    foreach (IGrouping<int, Solution> item in ViewBag.submitCountByMonth)
    {
        sb.Append("{ y: '");
        sb.Append(item.Key);
        sb.Append("', a: ");
        sb.Append(item.Count());
        sb.Append(", b: ");
        sb.Append(item.Count(x => x.Result == ResultType.Accepted));
        sb.Append(" },");
    }

    if (sb != null)
    {
        sb.Remove(sb.Length - 1, 1);
    }

    System.Text.StringBuilder rt = new System.Text.StringBuilder();
    foreach (IGrouping<int, User> item in ViewBag.peopleCountByMonth)
    {
        rt.Append("{ y: '");
        rt.Append(item.Key);
        rt.Append("', a: ");
        rt.Append(item.Count(x => x.Group == null|| (x.Group != null&&x.Group.Permission==PermissionType.Student)));
        rt.Append(", b: ");
        rt.Append(item.Count());
        rt.Append(" },");
    }

    if (rt != null)
    {
        rt.Remove(rt.Length - 1, 1);
    }
}

<!--Morris Chart CSS -->
<link rel="stylesheet" href="~/assets/plugins/morris/morris.css">



<div class="">
    <div class="page-header-title">
        <h4 class="page-title">@ViewData["Title"]</h4>
    </div>
</div>

<div class="page-content-wrapper ">

    <div class="container">

        <div class="row">
            <div class="col-sm-6 col-lg-3">
                <div class="panel text-center">
                    <div class="panel-heading">
                        <h4 class="panel-title text-muted font-light">注册人数</h4>
                    </div>
                    <div class="panel-body p-t-10">
                        <h2 class="m-t-0 m-b-15"><i class="mdi mdi-arrow-up text-danger m-r-10"></i><b>@ViewBag.peopleCount</b></h2>
                        <p class="text-muted m-b-0 m-t-20"><b>@ViewBag.people24Count</b> 来源于过去24小时</p>
                    </div>
                </div>
            </div>

            <div class="col-sm-6 col-lg-3">
                <div class="panel text-center">
                    <div class="panel-heading">
                        <h4 class="panel-title text-muted font-light">题目收录数</h4>
                    </div>
                    <div class="panel-body p-t-10">
                        <h2 class="m-t-0 m-b-15"><i class="mdi mdi-arrow-up text-success m-r-10"></i><b>@ViewBag.problemCount</b></h2>
                        <p class="text-muted m-b-0 m-t-20"><b>@ViewBag.problem24Count</b> 来源于过去一个月</p>
                    </div>
                </div>
            </div>

            <div class="col-sm-6 col-lg-3">
                <div class="panel text-center">
                    <div class="panel-heading">
                        <h4 class="panel-title text-muted font-light">总共提交数</h4>
                    </div>
                    <div class="panel-body p-t-10">
                        <h2 class="m-t-0 m-b-15"><i class="mdi mdi-arrow-up text-success m-r-10"></i><b>@ViewBag.submitCount</b></h2>
                        <p class="text-muted m-b-0 m-t-20"><b>@ViewBag.submit24Count </b> 来源于过去24小时</p>
                    </div>
                </div>
            </div>


            <div class="col-sm-6 col-lg-3">
                <div class="panel text-center">
                    <div class="panel-heading">
                        <h4 class="panel-title text-muted font-light">学习内容推荐数目</h4>
                    </div>
                    <div class="panel-body p-t-10">
                        <h2 class="m-t-0 m-b-15"><i class="mdi mdi-arrow-up text-danger m-r-10"></i><b>@ViewBag.learnCount</b></h2>
                        <p class="text-muted m-b-0 m-t-20"><b>@ViewBag.learn24Count</b> 来源于过去一个月</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">

            <div class="col-lg-4">
                <div class="panel panel-primary">
                    <div class="panel-body">
                        <h4 class="m-t-0">代码正确率</h4>

                        <ul class="list-inline widget-chart m-t-20 text-center">
                            <li>
                                <h4 class=""><b>@ViewBag.rightsubmitCount</b></h4>
                                <p class="text-muted m-b-0">正确通过</p>
                            </li>
                            <li>
                                <h4 class=""><b>@ViewBag.errorsubmitCount </b></h4>
                                <p class="text-muted m-b-0">错误答案</p>
                            </li>
                            <li>
                                <h4 class=""><b>@ViewBag.pendingsubmitCount</b></h4>
                                <p class="text-muted m-b-0">正在评测</p>
                            </li>
                        </ul>

                        <div id="morris-donut-example" style="height: 300px"></div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="panel panel-primary">
                    <div class="panel-body">
                        <h4 class="m-t-0">提交次数</h4>

                        <ul class="list-inline widget-chart m-t-20 text-center">
                            <li>
                                <h4 class=""><b>@ViewBag.submit1Count</b></h4>
                                <p class="text-muted m-b-0">一小时</p>
                            </li>
                            <li>
                                <h4 class=""><b>@ViewBag.submit24Count</b></h4>
                                <p class="text-muted m-b-0">一天</p>
                            </li>
                            <li>
                                <h4 class=""><b>@ViewBag.submit30Count </b></h4>
                                <p class="text-muted m-b-0">一个月</p>
                            </li>
                        </ul>

                        <div id="morris-bar-example" style="height: 300px"></div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="panel panel-primary">
                    <div class="panel-body">
                        <h4 class="m-t-0">访问次数</h4>

                        <ul class="list-inline widget-chart m-t-20 text-center">
                            <li>
                                <h4 class=""><b>@ViewBag.peopleStudentCount</b></h4>
                                <p class="text-muted m-b-0">学生 </p>
                            </li>
                            <li>
                                <h4 class=""><b>@ViewBag.peopleTeacherCount </b></h4>
                                <p class="text-muted m-b-0">老师</p>
                            </li>
                            <li>
                                <h4 class=""><b>@ViewBag.peopleAdminCount</b></h4>
                                <p class="text-muted m-b-0">管理员</p>
                            </li>
                        </ul>

                        <div id="morris-area-example" style="height: 300px"></div>
                    </div>
                </div>
            </div>

        </div>
        <!-- end row -->



    </div><!-- container -->

</div>
<!--Morris Chart-->
<script src="~/assets/plugins/morris/morris.min.js"></script>
<script src="~/assets/plugins/raphael/raphael-min.js"></script>


<script>

    !function ($) {
        "use strict";

        var Dashboard = function () {
        };


        //creates area chart
        Dashboard.prototype.createAreaChart = function (element, pointSize, lineWidth, data, xkey, ykeys, labels, lineColors) {
            Morris.Area({
                element: element,
                pointSize: 3,
                lineWidth: 1,
                data: data,
                xkey: xkey,
                ykeys: ykeys,
                labels: labels,
                resize: true,
                gridLineColor: '#3d4956',
                hideHover: 'auto',
                lineColors: lineColors
            });
        },
            //creates Bar chart
            Dashboard.prototype.createBarChart = function (element, data, xkey, ykeys, labels, lineColors) {
                Morris.Bar({
                    element: element,
                    data: data,
                    xkey: xkey,
                    ykeys: ykeys,
                    labels: labels,
                    gridLineColor: '#3d4956',
                    barSizeRatio: 0.4,
                    resize: true,
                    hideHover: 'auto',
                    barColors: lineColors
                });
            },

            //creates Donut chart
            Dashboard.prototype.createDonutChart = function (element, data, colors) {
                Morris.Donut({
                    element: element,
                    data: data,
                    resize: true,
                    colors: colors,
                    backgroundColor: '#2f3e47',
                    labelColor: '#fff'
                });
            },

            Dashboard.prototype.init = function () {

                //creating area chart
                var $areaData = [
                   @Html.Raw(rt.ToString())
                ];
            this.createAreaChart('morris-area-example', 0, 0, $areaData, 'y', ['a', 'b'], ['学生人数', '注册人数'], ['#00a3ff', '#04a2b3']);

                //creating bar chart
                var $barData = [
                   @Html.Raw( sb.ToString())
                ];

                this.createBarChart('morris-bar-example', $barData, 'y', ['a', 'b'], ['提交数', '通过数'], ['#04a2b3', '#00a3ff']);

                //creating donut chart
                var $donutData = [
                    { label: "正在评测", value: @ViewBag.pendingsubmitCount },
                    { label: "错误答案", value: @ViewBag.errorsubmitCount },
                    { label: "正确通过", value: @ViewBag.rightsubmitCount }
                ];
                this.createDonutChart('morris-donut-example', $donutData, ['#dcdcdc', '#e66060', '#04a2b3']);

            },
            //init
            $.Dashboard = new Dashboard, $.Dashboard.Constructor = Dashboard
    }(window.jQuery),

        //initializing
        function ($) {
            "use strict";
            $.Dashboard.init();
        }(window.jQuery);

</script>
